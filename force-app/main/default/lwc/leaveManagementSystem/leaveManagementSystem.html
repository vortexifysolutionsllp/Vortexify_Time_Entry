<template>

    <template if:true={showSpinner}>
        <lightning-spinner alternative-text="Loading" size="medium">
        </lightning-spinner>
    </template>

    <!-- TOP HEADER AREA -->
    <div class="leave-header" style="padding: 1rem;">

        <!-- LEFT: BALANCE CARDS -->
        <div class="balance-wrapper">
            <div class="balance-section">
                <template for:each={leaveBalances} for:item="bal">
                    <div key={bal.label} class="balance-card glow">
                        <div class="value">{bal.label}</div>
                        <div class="label"><b>Used:&nbsp;</b> {bal.value}</div>
                        <div class="label"><b>Remaining:&nbsp;</b>{bal.remaining}</div>
                    </div>
                </template>
            </div>
        </div>


    </div>

    <lightning-card title="Leave Requests" class="table-card">

        <lightning-button slot="actions" label="New" variant="brand" class="btn-new" onclick={openForm}>
        </lightning-button>

        <div class="datatable-wrapper">
            <lightning-datatable key-field="Id" data={leaveData} columns={columns} hide-checkbox-column
                class="futuristic-table">
            </lightning-datatable>
        </div>
    </lightning-card>

    <!-- FUTURISTIC MODAL -->
    <template if:true={isFormOpen}>
        <section class="slds-modal slds-fade-in-open futuristic-modal">
            <div class="slds-modal__container futuristic-modal-container">

                <header class="slds-modal__header modal-header">
                    <h2>New Leave Application</h2>
                </header>

                <div class="slds-modal__content modal-body">

                    <!--   <lightning-input label="Leave Application Name" data-id="recName"></lightning-input> -->

                    <!-- <lightning-input label="Status" value="Draft" disabled></lightning-input> -->

                    <template if:true={showModalError}>
                        <div class="slds-notify slds-notify_alert slds-alert_error slds-m-bottom_medium" role="alert">
                            <span class="slds-assistive-text">Error</span>
                            <span class="slds-icon_container slds-icon-utility-error slds-m-right_small">
                                <lightning-icon
                                    icon-name="utility:error"
                                    alternative-text="Error"
                                    size="small"
                                    variant="error">
                                </lightning-icon>
                            </span>
                            <h2>{modalErrorMessage}</h2>
                        </div>
                    </template>

                    <div class="form-grid">

                        <!-- LEFT COLUMN -->
                        <template if:false={hide}>
                            <lightning-input label="Status" value="Draft" disabled>
                            </lightning-input>
                        </template>

                        <template if:false={hide}>
                            <lightning-input label="Employee" value={employeeName} disabled>
                            </lightning-input>
                        </template>

                        <lightning-input type="date" label="Start Date" data-id="start" onchange={handleDateChange} required>
                        </lightning-input>

                        <lightning-input type="date" label="End Date" data-id="end" onchange={handleDateChange} required>
                        </lightning-input>

                        <lightning-combobox label="Leave Type" data-id="leaveType" options={leaveTypeOptions} required onchange={handleLeaveTypeChange}>
                        </lightning-combobox>

                        <lightning-input type="number" label="Number of Days" data-id="days" value={numberOfDays}
                            disabled>
                        </lightning-input>

                        <lightning-textarea class="full-width" label="Reason" data-id="reason" required>
                        </lightning-textarea>

                    </div>

                </div>
                <footer class="slds-modal__footer modal-footer">
                    <lightning-button label="Cancel" variant="neutral" onclick={closeForm}>
                    </lightning-button>

                    <lightning-button label="Save" variant="brand" class="btn-save" onclick={saveLeave}>
                    </lightning-button>
                </footer>

            </div>
        </section>

        <div class="slds-backdrop slds-backdrop_open futuristic-backdrop"></div>
    </template>

</template>